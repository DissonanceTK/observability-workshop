---
title: インフラストラクチャ演習 - パート2
linkTitle: パート2
weight: 2
---

{{% badge icon="clock" %}}10分{{% /badge %}}

インフラモニタリング演習のパート2です。今現在、単一のクラスタが表示されているはずです。

![Alt Cluster](../images/k8s-cluster.png)

* Kubernetes Navigator では、クラスタは黒い線で囲まれた四角形で表されます。
* その中に、ノードまたはコンピュートエンジンを表す1つ以上の青い四角形が含まれます。
* 1つまたは複数の色付きのボックスがその中に含まれています。これらは Pod を表しており、サービスが実行されています。
* **緑**は正常を示し、**赤**は問題があることを示します。

2つの赤いボックスまたはタイルがあるので、何が起こっているか、これがオンラインブティックサイトに影響するかどうかを確認しましょう。

{{% notice title="Exercise" style="green" icon="running" %}}

* まず、確認する時間枠を直近15分に変更します。フィルターペインの時間枠の設定欄ー **-4h** から **Last 15 minutes** に変更してください。
* マウスをクラスタ、ノード、およびPod、**緑**と**赤**の両方の上に重ねます。
* 表示される情報パネルには、オブジェクトの状態が表示されます。**赤い** Pod は **Pod Phase: Failed** であることが表示されます。これはクラッシュして機能していないことを意味します。
* クラスタに関するメトリクスチャートを調べてください（クラスタイメージの下にあるチャート）。これらはクラスタの健康状態に関する一般的な情報を提供します（メモリの消費量、ノードごとの Pod の数など）。
* クラッシュした Pod は Kubernetes のパフォーマンスに影響を与えないため、**赤い** Pod には何も表示されません。
* Spunk Kubernetes Analyzer によってもっと有用な情報を得られるか、確認してみましょう。**K8s Analyzer** をクリックします。
{{% notice title=" Spunk Kubernetes Analyzer" style="info" %}}

Splunk Kubernetes Analyzer は、Splunk Observability Cloud の中でバックグラウンド実行されるスマートなプロセスであり、複数の異常な振る舞いの間に関係性がないか検出するように設計されています。

{{% /notice %}}

* **K8s Analyzer** は、2つの**赤い** Pod が類似していることを検出しているはずで、それぞれの行の後に2が表示されています。また、同じ名前空間で実行されていることも示しています。
* K8s Analyzer のビューで、どの名前空間かを見つけることができますか？（ヒント: `k8s.namespace.name` を探してみてください）。
* 次に、この問題がノードレベルでも発生しているかどうかを確認するために、最初にクラスタ上にマウスを移動させ、左上に ![青い三角形](../images/node-blue-traingle.png?classes=inline) が表示されるまで待ち、それをクリックします。
* 各 Pod に小さなボックスが表示されるはずです。これは実際のコードを実行するコンテナを表しています。*K8s Analyzer* は、この問題がノードレベルでも発生していることを伝えてくれるはずです。

![Analyser result](../images/k8s-analyser-result.png?width=20vw)

* **K8s node** をクリックします。これにより、ノードのメトリクスが表示され、チャートを調べると、開発用の名前空間には2つの Pod しかないことがわかります。
* フィルターペインで`k8s.namespace.name=development`にフィルタリングすると、**＃Total Pods** チャートには2つの Pod しか表示されず、**Node Workload** チャートには*test-job* しかなく、失敗していることがわかります。

{{% notice title="Spunk Kubernetes Analyzer" style="info" %}}

上記のシナリオは、複数のチームが異なる開発段階にあるアプリケーションを、共有の Kubernetes 環境にデプロイする場合では一般的に発生しうるものです。 Kubernetes は、これらの環境を完全に分離するように設計されています。

{{% /notice %}}

{{% /notice %}}

オンラインブティックサイトを構成する Pod はすべて開発用の名前空間では実行されておらず、他のすべての Pod は緑です。したがって、これらの Pod は私たちに影響を与えないと安全して想定することができます。もうすこしだけ見てみましょう。
