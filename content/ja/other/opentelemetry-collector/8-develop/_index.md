---
title: OpenTelemetry Collector を開発する
linkTitle: 8. Develop
weight: 8
---

## カスタムコンポーネントの開発

Open Telemetry Collectorのためのコンポーネントを構築するには、以下の3つの主要な部分が必要です：

1. Configuration - _ユーザーが設定できる値は何か_
1. Factory - _提供された値を使ってコンポーネントを作成する_
1. Business Logic - _コンポーネントが実行する必要があること_

これについて、プロジェクトの重要なDevOpsメトリクスを追跡するためにJenkinsと連携するコンポーネントを構築する例を考えていきます。

測定しようとしているメトリクスは次のとおりです：

1. 変更に対するリードタイム - _「コミットが本番環境に入るまでにかかる時間」_
1. 変更失敗率 - _「本番環境での障害を引き起こすデプロイの割合」_
1. デプロイ頻度 - _「[チーム]が本番環境に成功してリリースする頻度」_
1. 平均復旧時間 - _「[チーム]が本番環境の障害から復旧するのにかかる時間」_

これらの指標は Google の [DevOps Research and Assessment (DORA)](https://dora.dev/) チームによって特定されたもので、ソフトウェア開発チームのパフォーマンスを示すのに役立ちます。_Jenkins CI_ を選択した理由は、私たちが同じオープンソースソフトウェアエコシステムに留まり、将来的にベンダー管理のCIツールが採用する例となることができるためです。

## 計装 🆚 コンポーネント

組織内でオブザーバビリティを向上させる際には、トレードオフが発生するため、考慮する点があります。

| | 長所 | 短所 |
| ----- | ----- | ----- |
| **（自動）計装**[^1] | システムを観測するために外部APIが不要 | 計装を変更するにはプロジェクトの変更が必要 |
| | システム所有者/開発者は可観測性の変更が可能 | ランタイムへの追加の依存が必要 |
| | システムの文脈を理解し、_Exemplar_ とキャプチャされたデータを関連付けることが可能 | システムのパフォーマンスに影響を与える可能性がある |
| **コンポーネント** | データ名や意味の変更をシステムのリリースサイクルから独立した展開が可能 | APIの破壊的な変更の可能性があり、システムとコレクター間でリリースの調整が必要 |
| | その後の利用に合わせて収集されるデータの更新/拡張が容易 | キャプチャされたデータの意味がシステムリリースと一致せず、予期せず壊れる可能性がある |


[^1]: 計装（instrument, インストゥルメント）とは、アプリケーションなどのシステムコンポーネントに対して、トレースやメトリクス、ログなどのテレメトリーデータを出力させる実装。計装ライブラリを最低限セットアップするだけで一通りのトレースやメトリクスなどを出力できるような対応を「自動計装」と呼びます。
